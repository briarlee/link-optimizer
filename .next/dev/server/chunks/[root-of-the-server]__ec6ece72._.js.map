{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/briar/Downloads/link-optimizer/src/app/api/score/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { SEOScore, SelectedLink } from '@/types';\n\ninterface ScoreInput {\n  text: string;\n  selectedLinks: SelectedLink[];\n}\n\nfunction calculateSEOScore(input: ScoreInput): SEOScore {\n  const { text, selectedLinks } = input;\n  const wordCount = text.split(/\\s+/).length;\n  const suggestions: string[] = [];\n\n  // 1. 链接密度评分 (理想: 每300-500字1个链接)\n  const totalLinks = selectedLinks.length;\n  const idealLinksMin = Math.floor(wordCount / 500);\n  const idealLinksMax = Math.ceil(wordCount / 300);\n  \n  let linkDensity = 100;\n  if (totalLinks < idealLinksMin) {\n    linkDensity = Math.max(50, 100 - (idealLinksMin - totalLinks) * 15);\n    suggestions.push(`Consider adding ${idealLinksMin - totalLinks} more links. Current density is low.`);\n  } else if (totalLinks > idealLinksMax) {\n    linkDensity = Math.max(40, 100 - (totalLinks - idealLinksMax) * 10);\n    suggestions.push(`You have ${totalLinks - idealLinksMax} more links than recommended. Consider removing some.`);\n  }\n\n  // 2. 锚文本多样性评分\n  const anchorTexts = selectedLinks.map(l => l.anchorText.toLowerCase());\n  const uniqueAnchors = new Set(anchorTexts);\n  const anchorDiversity = anchorTexts.length > 0 \n    ? Math.round((uniqueAnchors.size / anchorTexts.length) * 100)\n    : 100;\n  \n  if (anchorDiversity < 70) {\n    suggestions.push('Try to use more diverse anchor texts. Avoid repeating the same phrases.');\n  }\n\n  // 3. 内外链比例评分 (理想: 内链略多于外链)\n  const internalLinks = selectedLinks.filter(l => l.type === 'internal').length;\n  const externalLinks = selectedLinks.filter(l => l.type === 'external').length;\n  \n  let internalExternalRatio = 100;\n  if (totalLinks > 0) {\n    const ratio = internalLinks / totalLinks;\n    if (ratio < 0.3) {\n      internalExternalRatio = 60;\n      suggestions.push('Add more internal links to improve site navigation and SEO.');\n    } else if (ratio > 0.8) {\n      internalExternalRatio = 70;\n      suggestions.push('Consider adding external links to authoritative sources for credibility.');\n    } else if (ratio >= 0.4 && ratio <= 0.6) {\n      internalExternalRatio = 100;\n    } else {\n      internalExternalRatio = 85;\n    }\n  }\n\n  // 4. 额外检查\n  // 检查是否有重复链接\n  const urls = selectedLinks.map(l => l.url);\n  const uniqueUrls = new Set(urls);\n  if (uniqueUrls.size < urls.length) {\n    suggestions.push('Avoid linking to the same URL multiple times.');\n  }\n\n  // 检查锚文本长度\n  const longAnchors = anchorTexts.filter(a => a.split(/\\s+/).length > 5);\n  if (longAnchors.length > 0) {\n    suggestions.push('Some anchor texts are too long. Keep them under 5 words for better UX.');\n  }\n\n  // 计算总分\n  const overall = Math.round(\n    (linkDensity * 0.35) + \n    (anchorDiversity * 0.25) + \n    (internalExternalRatio * 0.4)\n  );\n\n  return {\n    overall,\n    linkDensity,\n    anchorDiversity,\n    internalExternalRatio,\n    suggestions,\n  };\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const score = calculateSEOScore(body);\n\n    return NextResponse.json({\n      success: true,\n      data: score,\n    });\n  } catch (error) {\n    console.error('Score calculation error:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to calculate score' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAQA,SAAS,kBAAkB,KAAiB;IAC1C,MAAM,EAAE,IAAI,EAAE,aAAa,EAAE,GAAG;IAChC,MAAM,YAAY,KAAK,KAAK,CAAC,OAAO,MAAM;IAC1C,MAAM,cAAwB,EAAE;IAEhC,gCAAgC;IAChC,MAAM,aAAa,cAAc,MAAM;IACvC,MAAM,gBAAgB,KAAK,KAAK,CAAC,YAAY;IAC7C,MAAM,gBAAgB,KAAK,IAAI,CAAC,YAAY;IAE5C,IAAI,cAAc;IAClB,IAAI,aAAa,eAAe;QAC9B,cAAc,KAAK,GAAG,CAAC,IAAI,MAAM,CAAC,gBAAgB,UAAU,IAAI;QAChE,YAAY,IAAI,CAAC,CAAC,gBAAgB,EAAE,gBAAgB,WAAW,oCAAoC,CAAC;IACtG,OAAO,IAAI,aAAa,eAAe;QACrC,cAAc,KAAK,GAAG,CAAC,IAAI,MAAM,CAAC,aAAa,aAAa,IAAI;QAChE,YAAY,IAAI,CAAC,CAAC,SAAS,EAAE,aAAa,cAAc,qDAAqD,CAAC;IAChH;IAEA,cAAc;IACd,MAAM,cAAc,cAAc,GAAG,CAAC,CAAA,IAAK,EAAE,UAAU,CAAC,WAAW;IACnE,MAAM,gBAAgB,IAAI,IAAI;IAC9B,MAAM,kBAAkB,YAAY,MAAM,GAAG,IACzC,KAAK,KAAK,CAAC,AAAC,cAAc,IAAI,GAAG,YAAY,MAAM,GAAI,OACvD;IAEJ,IAAI,kBAAkB,IAAI;QACxB,YAAY,IAAI,CAAC;IACnB;IAEA,2BAA2B;IAC3B,MAAM,gBAAgB,cAAc,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,YAAY,MAAM;IAC7E,MAAM,gBAAgB,cAAc,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,YAAY,MAAM;IAE7E,IAAI,wBAAwB;IAC5B,IAAI,aAAa,GAAG;QAClB,MAAM,QAAQ,gBAAgB;QAC9B,IAAI,QAAQ,KAAK;YACf,wBAAwB;YACxB,YAAY,IAAI,CAAC;QACnB,OAAO,IAAI,QAAQ,KAAK;YACtB,wBAAwB;YACxB,YAAY,IAAI,CAAC;QACnB,OAAO,IAAI,SAAS,OAAO,SAAS,KAAK;YACvC,wBAAwB;QAC1B,OAAO;YACL,wBAAwB;QAC1B;IACF;IAEA,UAAU;IACV,YAAY;IACZ,MAAM,OAAO,cAAc,GAAG,CAAC,CAAA,IAAK,EAAE,GAAG;IACzC,MAAM,aAAa,IAAI,IAAI;IAC3B,IAAI,WAAW,IAAI,GAAG,KAAK,MAAM,EAAE;QACjC,YAAY,IAAI,CAAC;IACnB;IAEA,UAAU;IACV,MAAM,cAAc,YAAY,MAAM,CAAC,CAAA,IAAK,EAAE,KAAK,CAAC,OAAO,MAAM,GAAG;IACpE,IAAI,YAAY,MAAM,GAAG,GAAG;QAC1B,YAAY,IAAI,CAAC;IACnB;IAEA,OAAO;IACP,MAAM,UAAU,KAAK,KAAK,CACxB,AAAC,cAAc,OACd,kBAAkB,OAClB,wBAAwB;IAG3B,OAAO;QACL;QACA;QACA;QACA;QACA;IACF;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,QAAQ,kBAAkB;QAEhC,OAAO,kLAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;QACR;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,kLAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA4B,GACrD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}